---
title: 'How to Publish Your Python Package to PyPI and TestPyPI with GitHub Actions'
description: 'Learn to set up PyPI and TestPyPI accounts, configure tokens, and automate Python package publishing using GitHub Actions.'
published: true
series: Python Development
tags: 'python, pypi, github-actions, ci-cd'
---

## üöÄ How to Publish Your Python Package to PyPI and TestPyPI with GitHub Actions

Publishing Python packages to PyPI ensures that your work can be installed and used by the community. Before pushing to the production PyPI, it's a good idea to test your package using TestPyPI - a sandboxed environment.

In this guide, you‚Äôll learn how to:

1. Set up accounts on both PyPI and TestPyPI.
2. Configure API tokens for secure publishing.
3. Use GitHub Actions to automate artifact builds and publishing.

---

## üåü Step 1: Create PyPI and TestPyPI Accounts

### 1.1. Register on PyPI

1. Visit [PyPI](https://pypi.org/).
2. Click Register in the top-right corner.
3. Fill in your details (username, email, password) and verify your email.

### 1.2. Register on TestPyPI

1. Visit [TestPyPI](https://test.pypi.org/).
2. Repeat the steps above using the same credentials (or different ones, depending on your preference).
3. Confirm your email address.

> Note: TestPyPI is separate from PyPI, so you need to register for both.

---

## üîë Step 2: Generate API Tokens for Secure Publishing

API tokens are safer than sharing your username/password and are required for automated publishing.

### 2.1. Generate a Token on PyPI

1. Log in to your [PyPI account](https://pypi.org/account/).
2. Navigate to Account Settings > API Tokens.
3. Click Add API Token.
4. Provide a name (e.g., "github-ci").
5. (Optional) Restrict the token to a specific project. Leave it blank to use it for any project.
6. Copy the token‚Äîyou won't see it again!

### 2.2. Generate a Token on TestPyPI

1. Log in to your [TestPyPI account](https://test.pypi.org/account/).
2. Repeat the steps above.

---

## üõ†Ô∏è PyPI vs TestPyPI: What‚Äôs the Difference?

Before diving deeper, let‚Äôs clarify the distinction between PyPI and TestPyPI:

### PyPI

- Purpose: The official repository for Python packages, used by developers and end-users to download and install packages.
- URL: [pypi.org](https://pypi.org)
- Production Environment: Packages uploaded here are publicly available and should be stable.

### TestPyPI

- Purpose: A testing environment for developers to validate their package setup, metadata, and upload process.
- URL: [test.pypi.org](https://test.pypi.org)
- Sandbox Environment: Packages uploaded here are not intended for production use and may be deleted periodically.

### Why Use TestPyPI?

1. Validation: Ensure your package builds correctly and metadata (e.g., description, dependencies) is accurate.
2. Avoid Mistakes: Catch issues in a safe environment before affecting PyPI users.
3. Testing CI/CD: Validate your publishing workflows without risk.

> Tip: Always test your package on TestPyPI before uploading to PyPI.

---

## üîß Step 3: Configure GitHub Secrets

Store your PyPI and TestPyPI credentials securely in GitHub Secrets.

1. Navigate to your repository on GitHub.
2. Go to Settings > Secrets and variables > Actions > New repository secret.
3. Add the following secrets:
   - `PYPI_USERNAME`: Set this to `__token`.
   - `PYPI_PASSWORD`: Paste your PyPI token.
   - `TEST_PYPI_USERNAME`: Set this to `__token`.
   - `TEST_PYPI_PASSWORD`: Paste your TestPyPI token.

---

## üîß Step 4: Configure `pyproject.toml`

Ensure your project is ready for packaging by defining its metadata in `pyproject.toml`. Here's an example:

[build-system]
requires = ["poetry-core>=1.0.0"]
build-backend = "poetry.core.masonry.api"

[tool.poetry]
name = "shortly"
version = "0.1.0"
description = "FastAPI-powered URL shortener for quick, reliable links"
authors = ["John Ajera <your-email@example.com>"]
readme = "README.rst"
license = "MIT"
classifiers = [
    "Development Status :: 3 - Alpha",
    "Intended Audience :: Developers",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Programming Language :: Python :: 3",
    "License :: OSI Approved :: MIT License",
    "Operating System :: OS Independent",
    "Framework :: FastAPI",
]

```

---

## üöºÔ∏è Step 5: Add GitHub Actions Workflow

Here‚Äôs a GitHub Actions workflow to build and publish your package to both TestPyPI and PyPI.

### Build and Publish Workflow

```yaml
name: Publish Python Package

on:
  push:
    tags:
      - 'v*' # Trigger workflow on version tags (e.g., v1.0.0)
  workflow_dispatch: # Allow manual triggering

jobs:
  build:
    name: Build Python Distribution
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.11

      - name: Install build tools
        run: pip install build twine

      - name: Build package
        run: python -m build

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: python-distribution
          path: dist/

  publish-to-testpypi:
    name: Publish to TestPyPI
    runs-on: ubuntu-latest
    needs: build

    steps:
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: python-distribution
          path: dist/

      - name: Publish to TestPyPI
        uses: pypa/gh-action-pypi-publish@release/v1
        with:
          repository-url: https://test.pypi.org/legacy/
        env:
          TWINE_USERNAME: ${{ secrets.TEST_PYPI_USERNAME }}
          TWINE_PASSWORD: ${{ secrets.TEST_PYPI_PASSWORD }}

  publish-to-pypi:
    name: Publish to PyPI
    runs-on: ubuntu-latest
    needs: build

    steps:
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: python-distribution
          path: dist/

      - name: Publish to PyPI
        uses: pypa/gh-action-pypi-publish@release/v1
        with:
          repository-url: https://upload.pypi.org/legacy/
        env:
          TWINE_USERNAME: ${{ secrets.PYPI_USERNAME }}
          TWINE_PASSWORD: ${{ secrets.PYPI_PASSWORD }}
```

---

## ‚úÖ Step 6: Tag a Release and Trigger the Workflow

1. Create a tag to trigger the workflow:

   ```bash
   git tag v1.0.0
   git push origin v1.0.0
   ```

2. GitHub Actions will:

   - Build the package.
   - Publish it to TestPyPI for validation.
   - Optionally, publish it to PyPI after passing checks.

---

## üö® Common Issues

- Missing API Tokens: Ensure tokens are properly stored in GitHub Secrets.
- Incorrect Metadata: Check `pyproject.toml` for missing or invalid fields.
- Publishing Errors: Validate your package with:

  ```bash
  python -m build
  twine check dist/*
  ```

---

## üåü Conclusion

By setting up accounts, tokens, and GitHub Actions, you‚Äôve automated the publishing process for your Python packages. Use TestPyPI to validate your build before releasing it to the world on PyPI.

Happy coding and publishing! üéâ
